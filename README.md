# テキストエディタ風 ToDo アプリ

テキストエディター的な操作感を基本に、アウトライン風のコンパクトUIで多情報表示する Web ToDo アプリケーション。  
インライン編集、スラッシュコマンド、キーボード操作のみで完結する Notion 風 UI を実装。

## ✨ 主な機能

### 📝 ブロックタイプ
- **テキスト (text)**: 通常のテキスト行
- **チェックボックス (checkbox)**: タスク管理用。チェックで削除線＋淡色化
- **リスト (list)**: 箇条書き項目（•付き）
- **水平線 (hr)**: 区切り線（編集不可）
- **見出し (heading)**: 太字見出し
- **折りたたみ見出し (collapsible-heading)**: クリックで配下の内容を折りたたみ／展開できる見出し
- **GTD見出し (gtd-heading)**: GTD専用の見出し。その日の最初のアクセス時に配下にタスクがあればリマインド通知

### 🎯 操作方法

#### スラッシュコマンド
行の先頭で以下のコマンドを入力すると、行のタイプを変換できます：

- `/c` → チェックボックス
- `/-` → リスト（箇条書き）
- `/_` → 水平線
- `/h` → 見出し
- `/b` → 折りたたみ見出し
- `/g` → GTD見出し

#### キーボード操作
- `Enter`: 行を確定し、次行を生成
  - チェックボックス → 次行もチェックボックス
  - リスト → 次行もリスト
  - 見出し・折りたたみ見出し・テキスト → 次行はテキスト
- `Shift+Enter`: 同一行で改行（行タイプは維持）
- `Backspace`/`Delete`（空行時）:
  - リスト → テキストに変換
  - チェックボックス → テキストに変換
  - テキスト → 行を削除
- `↑`/`↓`: 上下行へフォーカス移動
- `Esc`: 編集をキャンセル
- `Ctrl+Z`/`Cmd+Z`: 削除の復元（1ステップ）

#### インライン編集
- 行クリックで編集開始
- 未確定で他行に移動時は自動確定
- チェック済みのタスクは編集不可

#### 折りたたみ見出し機能
- 見出しの左側に折りたたみアイコン（▼/▶）が表示
- アイコンまたは行左端をクリックして折りたたみ／展開を切り替え
- 折りたたまれた状態では、見出し直後から次の見出しまたは水平線までのブロックが非表示
- 折りたたみ状態はデータベースに保存され、ページリロード後も維持
- キーボード操作：アイコンにフォーカス後、`Enter`または`Space`で切り替え

#### GTD見出しリマインド機能
- GTD見出し（📋アイコン付き）を作成すると、その配下のタスクを日次でリマインド
- その日の最初のアクセス時、GTD見出し配下に未完了タスクがあればポップアップ通知
- ポップアップから「OK（今日はもう大丈夫）」で当日のリマインドを停止
- 「再通知」機能で5分/10分/60分後に再度通知可能
- 設定画面で「リマインド済みフラグをリセット」すると、同じ日でも再度通知される

### 🎨 コンパクトな UI
- 行高: 30px
- フォント: 13px（見出し 15px）
- チェック済みタスク: 削除線＋フェード
- ホバーで削除ボタン表示
- ドラッグハンドルなし（並び替えUIなし）

### ♿ アクセシビリティ
- `tabindex` / `aria` 属性対応
- キーボード操作完全対応
- スクリーンリーダー対応

### 💾 データ保存
- SQLite3 に自動保存
- ページリロード後も内容、行タイプ、チェック状態、折りたたみ状態、順序を保持
- PHP ビルトインサーバーで動作

## 🚀 使い方

1. このフォルダで PHP ビルトインサーバーを起動:
   ```bash
   php -S localhost:8000
   ```

2. ブラウザで http://localhost:8000 を開く

3. 基本操作:
   - テキストを入力して `Enter` で行追加
   - `/c` でチェックボックス、`/-` でリスト、`/_` で水平線、`/h` で見出し、`/b` で折りたたみ見出し、`/g` でGTD見出しを作成
   - チェックボックスで完了/未完了を切り替え
   - 折りたたみ見出しの左側アイコンをクリックで折りたたみ／展開
   - GTD見出しは初回アクセス時に配下のタスクをリマインド通知
   - `×` ボタンで削除
   - `Enter` で同じタイプの行を続けて作成
   - 空行で `Backspace` を押すと、リスト/チェックボックスはテキストに変換

## 🪟 付箋風の小ウィンドウ化（Windows）
- Chrome/Edge: 右上メニュー → 「保存と共有」→「ショートカットを作成」→「ウィンドウとして開く」

## 📁 構成
- `index.html` : UI 構造
- `style.css`  : コンパクトデザインのスタイル
- `script.js`  : フロントロジック（contenteditable、スラッシュコマンド、APIコール）
- `api.php`    : CRUD + 並び替え API（SQLite3）
- `todo.db`    : 初回アクセス時に自動生成（.gitignore 対象）

## 💡 技術スタック
- **編集**: contenteditable とキーハンドリング
- **保存**: SQLite3 経由の API
- **データ構造**: `{ id, type, text, checked, order, collapsed }`
  - `type`: 'text' | 'checkbox' | 'list' | 'hr' | 'heading' | 'collapsible-heading' | 'gtd-heading'
  - `order`: 入力順（ソートキー）
  - `collapsed`: 折りたたみ状態（collapsible-heading のみ）
- **GTDリマインド**: localStorage でリマインド状態を管理（lastDate, doneForToday, snoozeUntil）

## 🗄️ データベース
既存のデータベースは自動的にマイグレーションされます。
- `type`: アイテムの種類（text/checkbox/list/hr/heading/collapsible-heading/gtd-heading）
- `sort_order`: 並び順
- `done`: チェック状態（既存フィールド、checkbox で使用）
- `collapsed`: 折りたたみ状態（collapsible-heading で使用）

GTDリマインド機能は localStorage を使用してブラウザごとに状態管理を行います。
